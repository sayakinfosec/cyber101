## Metasploit - Introduction

### ðŸ”¹ Overview
Metasploit is the most widely used exploitation framework. It supports all phases of penetration testing: information gathering, exploitation, post-exploitation, and more.

Two main versions:
- **Metasploit Pro**: Commercial version with GUI and automation features.  
- **Metasploit Framework**: Open-source CLI version (focus of this module).

The framework is useful for penetration testing, vulnerability research, and exploit development.

---

### ðŸ”¹ Main Components
- **msfconsole**: Main command-line interface.  
- **Modules**: Exploits, payloads, scanners, etc.  
- **Tools**: Stand-alone helpers like `msfvenom`, `pattern_create`, `pattern_offset`.  

**Key concepts:**
- **Vulnerability**: A flaw in design/coding/logic.  
- **Exploit**: Code that leverages a vulnerability.  
- **Payload**: Code that runs on the target after successful exploitation.  

---

### ðŸ”¹ Modules

```
root@ip-10-10-135-188:/opt/metasploit-framework/embedded/framework/modules# tree -L 1
.
â”œâ”€â”€ auxiliary
â”œâ”€â”€ encoders
â”œâ”€â”€ evasion
â”œâ”€â”€ exploits
â”œâ”€â”€ nops
â”œâ”€â”€ payloads
â””â”€â”€ post
```

#### Auxiliary
Supporting modules (scanners, crawlers, fuzzers).  

```bash
root@...:/modules# tree -L 1 auxiliary/
auxiliary/
â”œâ”€â”€ admin
â”œâ”€â”€ analyze
â”œâ”€â”€ client
â”œâ”€â”€ crawler
â”œâ”€â”€ dos
â”œâ”€â”€ fuzzers
â”œâ”€â”€ scanner
â””â”€â”€ ...
````

#### Encoders

Used to encode exploit/payloads to bypass signature-based AV.

```bash
root@...:/modules# tree -L 1 encoders/
encoders/
â”œâ”€â”€ cmd
â”œâ”€â”€ generic
â”œâ”€â”€ php
â”œâ”€â”€ x64
â””â”€â”€ x86
```

#### Evasion

Modules attempting antivirus evasion.

```bash
root@...:/modules# tree -L 2 evasion/
evasion/
â””â”€â”€ windows
    â”œâ”€â”€ applocker_evasion_install_util.rb
    â”œâ”€â”€ process_herpaderping.rb
    â””â”€â”€ windows_defender_js_hta.rb
```

#### Exploits

Exploits organized by platform.

```bash
root@...:/modules# tree -L 1 exploits/
exploits/
â”œâ”€â”€ aix
â”œâ”€â”€ android
â”œâ”€â”€ linux
â”œâ”€â”€ windows
â””â”€â”€ ...
```

#### NOPs

No-Operation instructions (0x90). Used as buffer fillers.

```bash
root@...:/modules# tree -L 1 nops/
nops/
â”œâ”€â”€ x64
â””â”€â”€ x86
```

#### Payloads

Code executed on target system.

```bash
root@...:/modules# tree -L 1 payloads/
payloads/
â”œâ”€â”€ adapters
â”œâ”€â”€ singles
â”œâ”€â”€ stagers
â””â”€â”€ stages
```

* **Singles**: Self-contained payloads.
* **Stagers**: Create channel to download full payload.
* **Stages**: The actual downloaded payload.
* **Adapters**: Wrap payloads (e.g., in PowerShell).

Examples:

* `generic/shell_reverse_tcp` â†’ **Single payload** (inline).
* `windows/x64/shell/reverse_tcp` â†’ **Staged payload**.

#### Post

Modules for post-exploitation (after access).

```bash
root@...:/modules# tree -L 1 post/
post/
â”œâ”€â”€ linux
â”œâ”€â”€ windows
â””â”€â”€ ...
```

---

### ðŸ”¹ Working with Modules

Launch Metasploit console:

```bash
msfconsole
```

**Common prompts:**

* `root@ip:~#` â†’ Normal shell.
* `msf6 >` â†’ Metasploit console.
* `msf6 exploit(...) >` â†’ In exploit/module context.
* `meterpreter >` â†’ Meterpreter session.
* `C:\Windows\system32>` â†’ Shell on target.

**Set parameters:**

```bash
set PARAMETER_NAME VALUE
```

**Show options:**

```bash
show options
```

Example:

```bash
msf6 exploit(windows/smb/ms17_010_eternalblue) > set rhosts 10.10.165.39
```

**Unset parameters:**

```bash
unset PARAMETER
unset all
```

**Global set (persists across modules):**

```bash
setg RHOSTS 10.10.165.39
unsetg RHOSTS
```

---

### ðŸ”¹ Using Modules

Run module:

```bash
exploit
```

Background session immediately:

```bash
exploit -z
```

Some modules support vulnerability **check** before exploitation.

---

### ðŸ”¹ Sessions

* **Background a session:**

```bash
meterpreter > background
```

* **List sessions:**

```bash
sessions
```

* **Interact with session:**

```bash
sessions -i 2
```

---

### ðŸ”¹ Common Parameters

* **RHOSTS** â†’ Target host(s)
* **RPORT** â†’ Target port
* **PAYLOAD** â†’ Payload type
* **LHOST** â†’ Attacker IP
* **LPORT** â†’ Attacker port (listener)
* **SESSION** â†’ Session ID for post modules

---

### ðŸ”¹ Q\&A Recap

* Code taking advantage of a flaw â†’ **Exploit**
* Code that runs on target â†’ **Payload**
* Self-contained payloads â†’ **Singles**
* `windows/x64/pingback_reverse_tcp` â†’ **Singles**
* Set LPORT to 6666 â†’ `set LPORT 6666`
* Set global RHOSTS â†’ `setg RHOSTS 10.10.19.23`
* Clear payload â†’ `unset PAYLOAD`
* Start exploitation phase â†’ `exploit`
